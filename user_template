#!/bin/bash

# Function to validate input
validate_input() {
    local prompt="$1"
    local validation_regex="$2"
    local error_message="$3"
    local input

    while true; do
        read -p "$prompt" input
        if [[ $input =~ $validation_regex ]]; then
            echo "$input"
            return 0
        else
            echo "$error_message"
        fi
    done
}

# Check macOS version
os_version=$(sw_vers -productVersion)
if [[ $(echo $os_version | cut -d. -f1) -lt 10 || ($(echo $os_version | cut -d. -f1) -eq 10 && $(echo $os_version | cut -d. -f2) -lt 9) ]]; then
    echo "This script requires macOS 10.9 or later. Your version: $os_version"
    exit 1
fi

# Check hardware compatibility
model=$(sysctl -n hw.model)
compatible_models=("MacBookPro15," "MacBookAir8," "Macmini8," "iMac19," "iMacPro1," "MacPro7," "Mac13,")
is_compatible=false
for prefix in "${compatible_models[@]}"; do
    if [[ $model == $prefix* ]]; then
        is_compatible=true
        break
    fi
done

if ! $is_compatible; then
    echo "This Mac model ($model) may not be compatible with macOS Sonoma."
    exit 1
fi

# Check RAM
total_ram=$(sysctl -n hw.memsize)
ram_gb=$((total_ram / 1024 / 1024 / 1024))
if [[ $ram_gb -lt 4 ]]; then
    echo "Your Mac needs at least 4GB of RAM. Current RAM: ${ram_gb}GB"
    exit 1
fi

# Check available disk space
available_space=$(df -H / | awk 'NR==2 {print $4}' | sed 's/G//')
if [[ $(echo "$available_space < 60" | bc) -eq 1 ]]; then
    echo "You need at least 60GB of available space
